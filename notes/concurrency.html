<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">

    <link href="../styles/maia.experimental.css" rel="stylesheet">

    <link href="../styles/portfolio.css" rel="stylesheet">

    <link href="../styles/bootstrap.css" rel="stylesheet">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script> <!-- JQuery-->




    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900&amp;subset=latin-ext" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Raleway:100,300,400,600&amp;subset=latin-ext" rel="stylesheet">
        <link href="http://fonts.googleapis.com/css?family=Roboto+Slab:300,400" rel="stylesheet" type="text/css">

        <script src="../scripts/handlebars-v4.0.5.js"></script>	<!-- handlebar library -->
    <script src="../scripts/bootstrap.min.js"></script> <!-- bootsrap libraries -->
    <script src="../scripts/jquery.lettering.js"></script>	<!-- lettering library -->
    <script src="../scripts/jquery.textillate.js"></script>	<!-- textillate library -->


    <title> Concurrency</title>
</head>

<body>

	               <!-- progress indicator-->
                   <div class="progress-indicator" aria-valuemin="0" aria-valuemax="100" role="progressbar">
						<div class="progress-indicator__wrapper">
						  <div class="progress-indicator__bar1"></div>
						  <div class="progress-indicator__bar2"></div>
						</div>
				</div>
	
				<!-- Header-->
				<header role="banner" class="page-header has-submenu">
					<nav class="page-header__drawer sticky-header">
						<div class="page-header__content content-controls content-controls--flex">
	
							<!-- for the home logo-->
							<div class="page-nav__header">
								<div class="page-logo-lockup gc-header-dt__lockup">
									<div title="Google Careers" aria-label="Google Careers" class="page-logo gc-header-dt__logo" data-ga-action="Header nav_Select" data-ga-label="Google Careers logo" role="menuitem">
										<div class="page-logo-text gc-header-dt__product-logo">
											<span aria-hidden="true" class="page-logo-text-span gc-header-dt__product-logo-text">Study space</span>
										</div>
									</div>
								</div>
	
							</div>
	
							<!--Container for the nav bars-->
							<div class="gc-header-dt__nav">
								<ul class="gc-header-dt__nav-list">

									<li class="gc-header-dt__nav-list-item">
											<a href="../index.html"  aria-label="Selected Link: Teams" data-ga-action="Header nav_Select" data-ga-label="Teams" role="menuitem">
												Home
											</a>
									</li>
									<li class="gc-header-dt__nav-list-item">
										<a href="../notes.html"  class="active" aria-label="Selected Link: Teams" data-ga-action="Header nav_Select" data-ga-label="Teams" role="menuitem">
											Notes
										</a>
									</li>
									<li class="gc-header-dt__nav-list-item">
										<a href="../resources.html" aria-label="Selected Link: Teams" data-ga-action="Header nav_Select" data-ga-label="Teams" role="menuitem">
											Resources
										</a>
									</li>

									<li class="gc-header-dt__nav-list-item">
											<a href="#"  aria-label="Selected Link: Teams" data-ga-action="Header nav_Select" data-ga-label="Teams" role="menuitem">
												Resume
											</a>
									</li>
								</ul>
	
							</div>
						
						</div>
	
                    </nav>
                    

                    <nav class="page-header__drawer sticky-header" >
                            <div class="page-header__content content-controls content-controls--flex" style="background-color: rgb(240,240,240);">
        
                                <!-- for the home logo-->
                                <div class="page-nav__header">
                                    <div class="page-logo-lockup gc-header-dt__lockup">
                                        <a href="#" title="Google Careers" aria-label="Google Careers" class="page-logo gc-header-dt__logo" data-ga-action="Header nav_Select" data-ga-label="Google Careers logo" role="menuitem">
                                            <div class="page-logo-text gc-header-dt__product-logo">
                                                <span aria-hidden="true" class="page-logo-text-span gc-header-dt__product-logo-text"></span>
                                            </div>
                                        </a>
                                    </div>
        
                                </div>
        
                                <!--Container for the nav bars-->
                                <div class="gc-header-dt__nav" style="margin-left: 11.8rem;">
                                    <ul class="gc-header-dt__nav-list">

                             
                                        <li class="gc-header-dt__nav-list-item">
                                            <a href="#" class="active"  role="menuitem"  >
                                                Concurrency
                                            </a>
                                        </li>
                                        <li class="gc-header-dt__nav-list-item">
                                            <a href="kafka.html" aria-label="Selected Link: Teams" role="menuitem" >
                                                Kafka
                                            </a>
                                        </li>
    
                                 
                                    </ul>
        
                                </div>
                            
                            </div>
        
                        </nav>
	
                </header>

<div class="page-body" data-modal-source id="a11y-main" role="main" tabindex="0">
    <div>
        <!-- <div class="blogPageLeftSide" id="knapsackLeftSide"></div> -->
        <div class="content-header--story"></div>


    </div>

    <div class="content-container content-row story-page story-page--restricted story-page--bottom">
        <div class="grid">

            <div class="grid__item desk--three-twelfths push--desk--one-twelfth tablet--four-twelfths">
                <div class="story-page__head-shot-container">
                    <div class="grid__item desk--four-twelfths story-page__head-shot-image" style="background-color:#fff;">
                    </div>
                    <div class="desk--eight-twelfths story-page__head-shot-caption">
                            <p class="story-page__head-shot-caption--text story-page__head-shot-name" tabindex="-1">System design</p>
                            <p class="head-shot-short-desc">Distributed systems, multi-threaded programming, concurrency</p>          
                    </div>
                </div>

            </div>
            <div class="grid__item desk--eight-twelfths push--desk--one-twelfth tablet--eight-twelfths story-page__story">
                <h1  class="content-title content-title--story">
                    Concurency, parallelism & distributed systems
                </h1>

        

                                                <p class="paragraphFontStyle"> 
                                                    We go about most of our day to day juggling multiple tasks. For example: While making 
                                                    breakfast in the morning, if it takes a while, we can maybe stretch in the mean time or 
                                                    prepare things to read for our commute to work.
                                                     </p>

                                                     <p class="paragraphFontStyle">
                                                            
                                                            At work, at some point, we may initiate a deployment process for a change we made and 
                                                            while our application is deploying, we might resort to working on a different task, or 
                                                            even maybe take a coffee break. And while getting coffee, while the coffee machine is in 
                                                            the process of making an Latte, we might decide to go and grab some snacks. If we carefully 
                                                            analyze our day, we can see that we’re quite adept at wisely handling multiple tasks. However, 
                                                            at a time, we can only do a single thing. We can’t get coffee while we’re in the process of 
                                                            initiating the deployment process; we can’t stretch while we’re actively cooking breakfast. 
                                                            We also can’t juggle our way through every type of tasks in such type of manner. Some tasks 
                                                            will  depend on other tasks. But we synchronize and execute our actions in a such way as to 
                                                            optimize our day. These situations are analogous to the concepts of concurrency, and parallelism. 
                                                            Parallelism refers to the ability of a system to execute multiple tasks at the exact same time, 
                                                            while Concurrency refers to the ability of a system to process multiple tasks independent of one 
                                                            another. However, these tasks may or may NOT be executed simultaneously. If a system can execute 
                                                            tasks in parallel, then it must be a concurrent system as well. The other way around, however, is 
                                                            not the case.
                                                     </p>


                                                     <p class="paragraphFontStyle"> 
                                                        
                                                            So these two concepts play a special role in an area such as distributed systems in which a vast 
                                                            number of resources connected over a network are interacting with one another and executing a vast 
                                                            set of tasks. In a distributed system a network of nodes and their resources are mimicking a single 
                                                            machine - each component executing its task independently and in parallel. Each component needs to 
                                                            work together in a co-ordinated and synchronized way to optimize for the overall efficiency of the 
                                                            system. We have to make sure that these systems are juggling the tasks they need execute to optimize 
                                                            the overall performance.  
   
                                                     </p>
                                                     
                                                        <p class="paragraphFontStyle"> 
                                                            
                                                                This is not unlike how we go about and reason our way through the tasks we execute each day. 
                                                                Even from a single machine’s perspective, it must be able to use it’s local resources and 
                                                                execute its tasks in an optimal way, and that might involve executing tasks concurrently or 
                                                                in parallel.
                                                         </p>


                                                         <p class="paragraphFontStyle"> 
                                                                 
                                                                To better understand how knowing these concepts helps build a distributed systems 
                                                                whose components co-operate in a seamless and optimized way to execute a tasks. If done correctly, 
                                                                we can see metrics such an an increased through and reduced latency, better data flow and so forth.
                                                                Let’s consider this basic example in which we have we have a simple data pipeline as shown below:
                                                        </p>

                                                        <img src="../images/4-queen.png" style=" width: 30%;"/>

                                                        <p class="paragraphFontStyle"> 
                                                                
                                                                As shown in the image, the idea is to have an application that produces content into a Kafka 
                                                                cluster(link to note on Kafka) and then have a consumer application that consumes the messages 
                                                                from Kafka on the other end. This consumer application will then process the messages and update 
                                                                some database.
                                                       </p>

                                                       <p class="paragraphFontStyle"> 
                                                            
                                                            If we imagine a scenario where none of the applications are utilizing the concepts of concurrency and 
                                                            parallelism, this is what would most likely happen:
                                                        </p>

                                                       <blockquote>
                                                            <ol>
                                                                <li>
                                                                        The application would receive one piece of content 
                                                                </li>
                                                                <li>
                                                                        Process that content
                                                                </li>
                                                                <li>
                                                                        Put that content to db
                                                                </li>

                                                                <li>
                                                                        Do the same for the other content coming from Kafka
                                                                </li>
                                                            </ol>
                                                        </blockquote>

                                                        <p class="paragraphFontStyle"> 
                                                                This would result in the overall flow of data in the system being significant slow. Especially in situations where there is a lot of content being pushed into the Kafka cluster, 
                                                                it’d be very hard to get changes out on time.
                                                       </p>


                                                       <p class="paragraphFontStyle"> 
                                                           
                                                            Further improvements can be made by having one independent ‘piece’ of the consumer application retrieve content from Kafka, then another ‘piece’ would process the content and update to the 
                                                            db. We can maybe have more than one piece of the application update the database. This is just a minor improvement and there are of course more imporvements that can be made 
                                                            to the system. And a lot of the decisions would depend on what exactly the application is doing, the nature of data it’s dealing with and the configurations of Kafka and 
                                                            the database. But the general idea is the same: if we have a better understanding of concepts of concurrency and concurrent programming, we can make better and more informed
                                                            decisions when being part of system design discussions and implementing changes.
                                                        </p>

                                                        <p class="paragraphFontStyle">
                                                                
                                                                Parallel and concurrent programming are made possible with concepts such as threads & processes. A thread is the simplest independently executable piece of code by the OS, 
                                                                and a process is just a running instance of a program (a set of instructions). A thread diverts functionality away from the main sequence of execution and operate 
                                                                in its own sequence of execution within a single process. This is known as multi-threaded programming. At the end of the day, it might be a single processor that’s 
                                                                juggling through these threads & processes, or there may be more than one processor(in which case parallelism is possible). 
                                                        </p>

                                                <p class="paragraphFontStyle"> 
                                                        So let’s go a bit deeper and see how we can write code with these two simple examples:
                                                </p>

                                                <p class="paragraphFontStyle"> 
                                                        We have a queue and we have a producer application that produces some content to the queue. Then a consumer on the other side will consume from the queue.
                                                        Let’s first try to mimic how such type of situation would look like in a single-threaded environment. So, the sequence of events in a single threaded environment
                                                         may look something like this:
                                                </p>

                                                <img src="../images/single_thread_producer_consumer.png" style=" width: 30%;"/>

                                      

                                                <p class="paragraphFontStyle"> 
                                                    
                                                        This particular approach, however, doesn’t make much sense. Producers and consumers are independent entities. Maybe we could improve this by having the consumers
                                                        and producers operate in separate threads. In this case, the flow may look something like this in java: 
                                                </p>
                                               
                                                <img src="../images/multithreaded_consumer_producer.png" style=" width: 30%;"/>

                                                <p class="paragraphFontStyle"> 
                                                        Now let’s introduce more scenarios to the problem. Imagine we want to push numbers that are divisible by 7 into the queue. 
                                                        We now have two producer threads. One thread will will be responsible for incrementing the shared number while the other thread 
                                                        will be responsible for checking divisibility and pushing to the queue.
                                                </p>

                                                <img src="../images/race_condition_producer_consumer.png" style=" width: 30%;"/>


                                                <p class="paragraphFontStyle"> 
                                                    
                                                        Now the code in the picture above won’t always produce the desired result. Numbers that aren’t divisible by 7 could very well be pushed into the queue. This could happen 
                                                        due to the lack of co-ordination between the two threads when accessing shared data(critical section). For example, let’s assume the message contains the number 7. 
                                                        Right after the sender thread checks the divisibility of the number in the message, it could be switched out by the OS. The modifier thread can then go and 
                                                        increment 7 and then get switched out. By the time the sender thread is active again and sends the message, the number in the message may no longer be divisible
                                                        by 7. This event is known as a race condition, and it happens when multiple threads race their way through the shared data.
                                                </p>

                                                <p class="paragraphFontStyle"> 
                                                        There are few OS concurrency constructs that help prevent such situations. One such construct is known as a Mutex. It can be thought of as a lock used to guard
                                                         the critical section. Once a thread acquires a mutex, only that thread can access the critical section. It will have to let go of the lock for other threads 
                                                         to gain access.  Most mutex implementations arbitarily choose one of the waiting threads once the mutex is free. 
                                                </p>


                                                 <p class="paragraphFontStyle"> 
                                                      
                                                        Another construct that helps prevent race conditions is a semaphore. A semaphore can be thought of as a way of restricting access the critical section to a specific
                                                         number of threads. It’s analogous to trying to get a reservation at a cafe. If there is no table available, you can’t get in. But when a table frees 
                                                         up then a new person can enter the the cafe. Thread pools are implemented using semaphores. For example, if the consumer application in the 
                                                         Kafka-based data pipeline example above has a consumer thread pool size of 8, that means a maximum of eight threads at a time can consume from Kafka. 
                                                 </p>

                                                 <p class="paragraphFontStyle"> 
                                                      
                                                        Semaphores are also used as a signaling mechanism between threads. For example, we can further improve the producer-consumer example above by introducing 
                                                        semaphores. We can use semaphores to have the producer sender thread signal the consumer thread/s that content has been pushed into the queue.
                                                 </p>

                                                 <p class="paragraphFontStyle"> 
                                                      
                                                        Another important concurrency construct that is specific to programming languages than the OS is a Monitor. In a way it combines the functionalities of a mutex 
                                                        and a semaphore even though it’s best to think of a Monitor as a Mutex with an an extra feature. The reason is because only a single thread can enter the monitor 
                                                        and access the critical section at a time. However, monitors introduce the idea of condition variables, and based on the state of these condition variables a 
                                                        thread can either lock and access a critical section or wait until the criteria for the condition variable is satisfied by another thread. We can replace 
                                                        semaphores as a signaling mechanism between the producer and consumer above with monitors.
 
                                                 </p>

                                                 <img src="../images/monitors_consumer_producer.png" style=" width: 30%;"/>

                                                 <p class="paragraphFontStyle"> 
                                                      
                                                        So it is not hard to see that utilizing concepts of concurrency can help immensely in terms of throughput, latency and overall a more optimized use of resources. 
                                                        However, a lot of problems could potentially arise as well, especially if each component is not co-ordinated well enough. It’s also not easy to maintain 
                                                        and debug codebases with multi-threaded programming. If used in the wrong situation, it might result in the program slowing down as well. It’s really not 
                                                        unlike daily issues we face when context switch among several tasks we’re working on and as a result, we end up not making not as much progress as we 
                                                        would have liked. So it’s best to analyze each use case before deciding which route to take. It may be challenging, but it’s worth taking the time 
                                                        to learn more and improve.
                                                 </p>

                                                


                                          
            </div>
        </div>
    </div>

    <div class="page-row-2">
        <div class="content-container">
            <div class="grid">
                <div class="grid__item desk--eight-twelfths push--desk--four-twelfths tablet--eight-twelfths push--tablet--four-twelfths">
                    <h2 class="related-content__header">Related content</h2>
                        <!-- <div class="related-content__item related-content__item--compact">
                                <h3 class="related-content__title">Note 1</h3>
                                <p class="related-content__content related-content__content--always-open">Blah blah blah short description of note 1</p>
                                <a href="#" class="related-content__link">See More</a>
                        </div> -->
                        <!-- <div class="related-content__item related-content__item--compact">
                                <h3 class="related-content__title">Note 2</h3>
                                <p class="related-content__content related-content__content--always-open">Lorem ipsum blah blah descirption fo note 2 lorem ipsum shit</p>
                                <a href="#" class="related-content__link" >See More</a>
                        </div> -->




    

                        <!-- test 3-->
                        <div class="content-container mobile--hide" style="padding-left: 0;">
                            <div class="content-row content-row--flush-bottom related-content related-content--padded">
                                <div class="grid">

                                         <!--item 1-->
                                        <div class="grid__item tablet--one-half related-content__item--shifted desk--one-third">
                                            <div class="related-content__item">
                                                <h4 class="related-content__title">
                                                    <a  class="relatedContentLink" href="https://ocw.mit.edu/courses/civil-and-environmental-engineering/1-124j-foundations-of-software-engineering-fall-2000/lecture-notes/multithreading/">Multi-threading</a>
                                                </h4>
                                                <p class="related-content__content">
                                                    In-depth exploration of multi-threading concepts including Java implementing
                                                </p>
                                            </div>
                                        </div>


                                </div>
                            </div>
                        </div>



                       
                </div>
            </div>

        </div>

    </div>
</div>



<footer class="hashcode-footer mdl-mini-footer">
	    <div class="mdl-mini-footer__left-section">
		   <p class="mdl-typography--font-light">

              © 2020 Study space

			  <a href="../index.html">
			      Go to homepage
			  </a>

			  <a href="../notes.html">
			      Read notes
			  </a>

			  <a href="../resources.html">
			      Browse through resources
			  </a>


			  <a href="https://www.linkedin.com/in/nathnael-alemu-1b78bb107/">
			      View LinkedIn
			  </a>

		   </p>
		</div>

	</footer>


</body>


</html>